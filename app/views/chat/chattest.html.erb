<!DOCTYPE html>
<html>
  <head>
    <title>Ruby WebSockets Chat Test</title>
  </head>
  <body>
    <div class="container">
      <div class="jumbotron">
        <h1>Ruby WebSockets Chat Test</h1>
        <p>This is a Ruby WebSockets Chat Demo. The code lives <a href="https://github.com/heroku-examples/ruby-websockets-chat-demo">on GitHub</a>. You can find the full guide <a href="https://devcenter.heroku.com/articles/ruby-websockets">on Heroku DevCenter</a>.</p>
 <div id="test-chat-box" class="container" data-chatgroup="<%= @chat_group ||= 'default' %>">
  <form id="chat-input-form" class="form-inline">
    <div class="form-group">
      <input id="input-text" type="text" class="form-control" placeholder="Enter chat text here!" autofocus />
    </div>
    <button class="btn btn-primary" type="submit">Send</button>
  </form>
  <div class="page-header">
    <h1>Chat</h1>
   </div>
   <div id="chat-system">
   </div>
   <div id="chat-text">
   </div>
</div>
  </body>
<script>
      var scheme = "<%= ENV['RACK_ENV'] == 'production' ? 'wss://' : 'ws://' %>";
      var uri      = scheme + window.document.location.host + "/chat/"; 
      var ws=new WebSocket(uri);

      ws.onmessage = function(message) {
          var data = JSON.parse(message.data);

            $("#chat-system").append("<div class='panel panel-default'> <div class='panel-body'>" + data.text + "</div></div>");

              
              $("#chat-text").stop().animate({
                    scrollTop: $('#chat-text')[0].scrollHeight
                  }, 800);
      };

      $("#chat-input-form").on("submit", function(event) {
          event.preventDefault();
            var text   = $("#input-text")[0].value;
              ws.send(JSON.stringify({text: text }));
                $("#input-text")[0].value = "";
      });
</script>


</html>
